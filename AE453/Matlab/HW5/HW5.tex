\documentclass[11pt]{article}
\usepackage[utf8]{inputenc} % Para caracteres en español
\usepackage{amsmath,amsthm,amsfonts,amssymb,amscd}
\usepackage{multirow,booktabs}
\usepackage[table]{xcolor}
\usepackage{fullpage}
\usepackage{lastpage}
\usepackage{enumitem}

\usepackage{tikz}
\newcommand{\stencilpt}[4][]{\node[circle,draw,inner sep=0.3em,minimum size=2cm,#1] at (#2) (#3) {#4}}
\newcommand{\stencilpta}[4][]{\node[square,draw,inner sep=0.3em,minimum size=2cm,#1] at (#2) (#3) {#4}}



\usepackage{multicol}
\usepackage{fancyhdr}
\usepackage{mathrsfs}
\usepackage{pdfpages}
\usepackage{wrapfig}
\usepackage{setspace}
\usepackage{esvect}
\usepackage{calc}
\usepackage{multicol}
\usepackage{cancel}
\usepackage{graphicx}
\graphicspath{ {pictures/} }
\usepackage[retainorgcmds]{IEEEtrantools}
\usepackage[margin=3cm]{geometry}
\usepackage{amsmath}
\newlength{\tabcont}
\setlength{\parindent}{0.0in}
\setlength{\parskip}{0.05in}
\usepackage{empheq}
\usepackage{framed}
\usepackage[most]{tcolorbox}
\usepackage{xcolor}
\colorlet{shadecolor}{orange!15}
\parindent 0in
\parskip 12pt
\geometry{margin=1in, headsep=0.25in}
\theoremstyle{definition}
\newtheorem{defn}{Definition}
\newtheorem{reg}{Rule}
\newtheorem{exer}{Exercise}
% Two more packages that make it easy to show MATLAB code
\usepackage[T1]{fontenc}
\usepackage[framed,numbered]{matlab-prettifier}
\lstset{
	style = Matlab-editor,
	basicstyle=\mlttfamily\small,
}
\newtheorem{note}{Note}
\begin{document}  
\setcounter{section}{0}
\thispagestyle{empty}

\begin{center}
{\LARGE \bf Homework 5}\\
{\large AE435 - Spring 2018 \\ Emilio R. Gordon}
\end{center}
\vspace{0mm}
\textbf{Problem 2} \\ \\

The Aerojet MR-501B has: 
\begin{itemize}
 \item A Thrust of: 233 [mN];
 \item Specific impulse: 300 [sec];
 \item A Thrust Efficiency of: 68.53 $\%$; 
 \item Throat Diameter: 0.15647 [mm];
 \item Nozzle Exit Diameters: 0.89885 [mm]
\end{itemize}

%\begin{figure}[h!]
\begin{lstlisting}
clear; clc; format short
%% Define Parameters

% Given
mdot = 61; % Mass Flow Rate [mg/s]
AeAt = 33; % Nozzle Expansion Ratio
T = 2050;  % Peak Temperature [K]
Pc = 200;   % Feed Pressure [psia]
Pin = 500; % Input Power [kg/s]
x = 0.7;   % Dissasociation
gamma = 1.351; % Adiabatic Index (See Notes)

% Universal
MW_N2H4 = 32.0452; % Molecular Weight Hydrazine [g/mol]
MW_NH3 = 17.03052; % Molecular Weight Ammonia [g/mol]
MW_N2 = 28.014;    % Molecular Weight N2 [g/mol]
MW_H2 = 2.016;     % Molecular Weight H2 [g/mol]

R = 8.314; % Universal Gas Constant [J/mol.K]

%% Conversions

mdot = mdot*1e-6; % [mg/s] to [kg/s]
Pc = Pc*6894.76;  % [psia] to [Pa]=[kg/m.s^2]

%% Find Weighted Averages

mBar_NH3 = (4/3)*(1-x); % Moles of NH3 [mol]
mBar_N2 = (1/3)*(1+2*x); % Moles of N2 [mol]
mBar_H2 = 2*x; % Moles of H2 [mol]
mBar_all = mBar_NH3+mBar_N2+mBar_H2;

mFrac_NH3 = mBar_NH3/mBar_all; % Mass of NH3 [g]
mFrac_N2 = mBar_N2/mBar_all; % Mass of N2 [g]
mFrac_H2 = mBar_H2/mBar_all; % Mass of H2 [g]

%% Weighted Average for Molecular Weight [g/mol]
MW_avg = (mFrac_NH3*MW_NH3)+(mFrac_N2*MW_N2)+(mFrac_H2*MW_H2);

%% Specific Gas Constant [J/g.K]
R_N2H4 = R/MW_avg;    % [J/g.K]
R_N2H4 = R_N2H4*1000; % [J/kg.K]

%% Equation 7.59
syms Pe
% Exit Area Pressure [Pa]
Pe = solve((1/AeAt) == ((gamma+1)/(2))^((1)/(gamma-1))*(Pe/Pc)^(1/gamma)*sqrt(((gamma+1)/(gamma-1))*(1-(Pe/Pc)^((gamma-1)/gamma))),Pe);

%% Equation 7.58
% Throat Area [m^2]
A_t = mdot/(Pc*sqrt((gamma/(R_N2H4*T))*(2/(gamma+1))^((gamma+1)/(gamma-1))));
% Throat Area [mm^2]
A_t = A_t*1000^2;
% Exit Area [mm^2]
A_e = A_t*AeAt;

%% Equation 7.48
% Exit Velocity [m/s]
Ue = sqrt(((2*gamma*R_N2H4*T)/(gamma-1))*(1-((Pe)/(Pc))^((gamma-1)/(gamma))));

% Thrust [N]
Thrust = mdot*Ue+A_e*10e-6*Pe;

% Specific Impulse [sec]
I_SP = Ue/9.81;

% Thruster Efficiency [%]
eta = 0.5*Thrust*Ue / 500;

sprintf('The Aerojet MR-501B has: \n A Thrust of %d (mN);\n Specific impulse %d (sec);\n A Thrust Efficiency of %0.2f (percent); \n Throat Diameter %0.5f (mm);\n Nozzle Exit Diameters %0.5f (mm)', Thrust*1000,I_SP, eta*100, vpa(sqrt(A_t/pi)), vpa(sqrt(A_e/pi)))
\end{lstlisting}
%\caption{Building the A Matrix for the Linear System}
%\label{FormA}
%\end{figure}

\newpage
\textbf{Problem 3}

Equilibrium Degree of Disassociation in the Combustion Chamber is 14.730 $\%$

The Combustion Chamber Enthalpy is 27814467145918061005129272786944.000

The Ratio of Specific Heats is 3.501

Assuming Frozen Flow with this Chamber Composition we get:
\begin{itemize}
 \item A Thrust of 74.973 (mN);
 \item Specific impulse 30.52 (sec);
 \item A Thrust Efficiency of 0.01 $\%$; 
 \item Throat Diameter 0.37385 (mm);
 \item Nozzle Exit Diameters 0.53485 (mm)
\end{itemize}

Assuming the flow maintains equilibrium as it expands
\begin{itemize}
\item Exit Temperature for an Isentropic Nozzle is 149 [K]
\item The Exit Enthalpy is 0
\item A Thrust of 107.916 (mN);
\item Specific impulse 45.78 (sec);
\item A Thrust Efficiency of 0.02 (percent)
\end{itemize}
\begin{lstlisting}
clear; clc; format short
%% Define Parameters

%Given
Pin = 100; % Input Power [kW]
Tc = 4000; % Chamber Temperature [K]
Pc = 1; % Chamber Pressure [atm]
mdot = 220; % Mass Flow Rate [mg/s]
Pe = 0.01; % Exit Pressure [atm]

%Universal
m_H2 = 1.673723e-27; %MW of H2 [kg]
R = 8.314; % Universal Gas Constant [J/mol.K]

%% Conversions

mdot = mdot*1e-6;  % [mg/s] to [kg/s]
Pc = Pc*101325;    % [atm] to [Pa]=[kg/m.s^2]
Pe = Pe*101325;    % [atm] to [Pa]=[kg/m.s^2]
Pin = Pin*1000;    % [kW] to [W]

%% Dissassociation Calculation
% At Tc = 4000 [K]
K = exp(0.934);

X2HXH2 = K/(Pc/Pe);

sol = roots([-1, -X2HXH2, X2HXH2]);

X = sol(2); % Dissasociation
sprintf('Equillibrium Degree of Dissasociatio in the Combustion Chamber is %0.3f(percent)', X*100)

No = 1/m_H2;
alpha2 = 1-X;
alpha1 = 2*X;

%% Combustion Chamber Enthalpy and Ratio of Specific Heat
hc = No*(alpha2*((9/2)*K*Tc)+alpha1*((5/2)*K*Tc+0.5*X));
sprintf('The Combustion Chamber Enthalpy is %0.3f', hc)

syms gamma
eqn1 = (hc/Tc) == (gamma*R)/((gamma-1)*m_H2);

gamma = vpa(solve(eqn1,gamma));
sprintf('The Ratio of Specific Heats is %0.3f', gamma)

%% Area Calculations
% Equation 7.58 - Throat Area [m^2]
A_t = mdot/(Pc*sqrt((gamma/(R*Tc))*(2/(gamma+1))^((gamma+1)/(gamma-1))));
% Equation 7.59 - Exit Area [m^2]
syms A_e
A_e = solve((A_t/A_e) == ((gamma+1)/(2))^((1)/(gamma-1))*(Pe/Pc)^(1/gamma)*sqrt(((gamma+1)/(gamma-1))*(1-(Pe/Pc)^((gamma-1)/gamma))),A_e);

% Throat Area [mm^2]
A_t = A_t*1000^2;
% Exit Area [mm^2]
A_e = A_e*1000^2;

% Throat Diameter [mm]
D_t = vpa(sqrt(A_t/pi));
% Exit Diameter [mm]
D_e = vpa(sqrt(A_e/pi));

%% Part C Answers
% Equation 7.48 - Exit Velocity [m/s]
Ue = sqrt(((2*gamma*R*Tc)/(gamma-1))*(1-((Pe)/(Pc))^((gamma-1)/(gamma))));
% Thrust [N]
Thrust = mdot*Ue+A_e*10e-6*Pe;
% Specific Impulse [sec]
I_SP = Ue/9.81;
% Thruster Efficiency [%]
eta = 0.5*Thrust*Ue / Pin;

sprintf('Assuming Frozen Flow with this Chamber Composition we get:\n A Thrust of %0.3f (mN);\n Specific impulse %0.2f (sec);\n A Thrust Efficiency of %0.2f (percent); \n Throat Diameter %0.5f (mm);\n Nozzle Exit Diameters %0.5f (mm)', Thrust*1000,I_SP, eta*100, D_t, D_e)

%% Part D Answers

% Isentropic Pressure Relation - T2/T1 = (P2/P1)^(1-(1/gamma))

% Exit Temperature [K]
Te = Tc*(Pe/Pc)^((gamma-1)/gamma);
sprintf('Exit Temperature for an Isentropic Nozzle is %d [K]',Te)
% Dissassociation Calculation - At Te = 150 [K]
K = exp(-164.005);

X2HXH2 = K/(Pc/Pe);

sol = roots([-1, -X2HXH2, X2HXH2]);

X = sol(1); % Dissasociation
sprintf('Equillibrium Degree of Dissasociatio in the Combustion Chamber is %0.3f(percent)', X*100)

No = 1/m_H2;
alpha2 = 1-X;
alpha1 = 2*X;
xi_Frozen = 1;
xi_Equillibrium = 0;

hc = No*(alpha2*((9/2)*K*Tc)+alpha1*((5/2)*K*Tc+0.5*X));
he = 0.5*xi_Equillibrium*alpha1*No*X
sprintf('The Exit Enthalpy is %0.5f', he)

% Equation 7.48 - Exit Velocity [m/s]
%Ue = sqrt(((2*gamma*R*Te)/(gamma-1))*(1-((Pe)/(Pc))^((gamma-1)/(gamma))))
%1D Energy Equation for Nozzle Flow
%Ue = sqrt(2*(hc-he))
%Equation 7.61
Ut = sqrt(gamma*R*Tc)
Ue = Ut*sqrt(((gamma+1)/(gamma-1))*(1-((Pe)/(Pc))^((gamma-1)/(gamma))))

% Thrust [N]
Thrust = mdot*Ue+A_e*10e-6*Pe
% Specific Impulse [sec]
I_SP = Ue/9.81
% Thruster Efficiency [%]
eta = 0.5*Thrust*Ue / Pin

sprintf('Assuming The Flow Maintains Equillibrium We Get:\n A Thrust of %0.3f (mN);\n Specific impulse %0.2f (sec);\n A Thrust Efficiency of %0.2f (percent)', Thrust*1000,I_SP, eta*100)

\end{lstlisting}

\end{document}